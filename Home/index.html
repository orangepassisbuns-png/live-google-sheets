<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
    <title>Live Google Sheets</title>
    <link rel="stylesheet" href="../css/style.css" />
</head>
<body>

    <div id="table-container">Loading...</div>

    <script>
        const sheetURL =
            "https://docs.google.com/spreadsheets/d/e/2PACX-1vRVNjYWdmhnWQvuf8Lpd6r6o9YLttKsfJh7pHy3CbAYmwTU-ce3j85O9jPhNM0U4k7Lx7vH9gnckoNV/pub?output=csv";

        function parseCSV(text) {
            return text.split("\n").map(row => row.split(","));
        }

        function parseTimestamp(ts) {
            return new Date(ts);
        }

        function buildTable(rows) {
            let html = `<div class="table-wrapper"><table>`;

            rows.forEach((row, idx) => {
                html += idx === 0 ? "<tr class='header'>" : "<tr>";
                row.forEach(cell => html += `<td>${cell}</td>`);
                html += "</tr>";
            });

            html += "</table></div>";
            return html;
        }

        fetch(sheetURL)
            .then(res => res.text())
            .then(csv => {
                let rows = parseCSV(csv);

                const header = rows[0];
                const body = rows.slice(1);

                const timestampIndex = header.indexOf("Timestamp");

                if (timestampIndex !== -1) {
                    body.sort((a, b) => {
                        const dateA = parseTimestamp(a[timestampIndex]);
                        const dateB = parseTimestamp(b[timestampIndex]);
                        return dateB - dateA;
                    });
                }

                const sortedRows = [header, ...body];
                document.getElementById("table-container").innerHTML =
                    buildTable(sortedRows);
            })
            .catch(err => {
                document.getElementById("table-container").textContent =
                    "Error loading data.";
                console.error(err);
            });
    </script>

</body>
</html>
